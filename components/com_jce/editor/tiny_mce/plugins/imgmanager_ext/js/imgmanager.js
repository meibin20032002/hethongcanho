/* jce - 2.6.24 | 2018-01-24 | http://www.joomlacontenteditor.net | Copyright (C) 2006 - 2018 Ryan Demmer. All rights reserved | GNU/GPL Version 2 or later - http://www.gnu.org/licenses/gpl-2.0.html */
!function(){var ImageManagerDialog={settings:{},init:function(){tinyMCEPopup.restoreSelection();var br,ed=tinyMCEPopup.editor,n=ed.selection.getNode(),self=this;$("button#insert").click(function(e){self.insert(),e.preventDefault()});var src=ed.convertURL(ed.dom.getAttrib(n,"src"));if(src=decodeURIComponent(src),$.each(this.settings.attributes,function(k,v){parseFloat(v)||$("#attributes-"+k).hide()}),Wf.init(),$("#alt").addClass("uk-input-multiple"),$("#src, #popup_src").addClass("uk-input-multiple-disabled").attr("placeholder",tinyMCEPopup.getLang("imgmanager_ext.select_multiple","Multiple Image Selection")),$("#onmouseover, #onmouseout").addClass("uk-persistent-focus").on("click focus",function(){$("#onmouseover, #onmouseout").removeClass("uk-active"),$(this).addClass("uk-active")}),$("#responsive_picture").click(function(){$('input[name^="responsive_media_query"]').prop("disabled",!this.checked)}),$('input[name^="responsive_width_descriptor"], input[name^="responsive_pixel_density"]').on("change",function(){this.value=this.value.replace(/[^0-9\.]+/g,"")}),$("#responsive_tab").on("click focus",'input[name^="responsive_source"]',function(e){$('input[name^="responsive_source"]').removeClass("uk-active"),$(this).addClass("uk-active")}),$("body").on("click.persistent-focus",function(e){$(e.target).is(".uk-persistent-focus")||$(e.target).is("li.file")||$(e.target).parents("li.file").length||$(".uk-persistent-focus").removeClass("uk-active")}),WFPopups.setup(),$("#popup_list").change(function(){var selected=$.fn.filebrowser.getselected();1===selected.length&&self.selectFile(selected[0]),selected.length>1&&self.selectMultiple()}),n&&"IMG"==n.nodeName){$("#insert").button("option","label",tinyMCEPopup.getLang("update","Update",!0)),$("#src").val(src);var w=Wf.getAttrib(n,"width"),h=Wf.getAttrib(n,"height");$("#width").val(function(){return w?($(this).addClass("uk-isdirty"),w):h?void 0:n.width}),$("#height").val(function(){return h?($(this).addClass("uk-isdirty"),h):w?void 0:n.height}),$("#alt").val(ed.dom.getAttrib(n,"alt")),$("#title").val(ed.dom.getAttrib(n,"title")),$.each(["top","right","bottom","left"],function(){$("#margin_"+this).val(Wf.getAttrib(n,"margin-"+this))}),$("#border_width").val(function(){var v=Wf.getAttrib(n,"border-width");return 0==$('option[value="'+v+'"]',this).length&&$(this).append(new Option(v,v)),v}),$("#border_style").val(Wf.getAttrib(n,"border-style")),$("#border_color").val(Wf.getAttrib(n,"border-color")),$("#border").is(":checked")||$.each(["border_width","border_style","border_color"],function(i,k){$("#"+k).val(self.settings.defaults[k]).change()}),$("#align").val(Wf.getAttrib(n,"align")),$("#classes").val(ed.dom.getAttrib(n,"class")),$("#style").val(ed.dom.getAttrib(n,"style")),$("#id").val(ed.dom.getAttrib(n,"id")),$("#dir").val(ed.dom.getAttrib(n,"dir")),$("#lang").val(ed.dom.getAttrib(n,"lang")),$("#usemap").val(ed.dom.getAttrib(n,"usemap")),$("#insert").button("option","label",ed.getLang("update","Update")),$("#longdesc").val(ed.convertURL(ed.dom.getAttrib(n,"longdesc"))),$("#onmouseout").val(src),$.each(["onmouseover","onmouseout"],function(){v=ed.dom.getAttrib(n,this),v=$.trim(v),v=v.replace(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/,"$1"),v=ed.convertURL(v),$("#"+this).val(v)}),br=n.nextSibling,br&&"BR"==br.nodeName&&br.style.clear&&$("#clear").val(br.style.clear),(popup=WFPopups.getPopup(n))&&$("#popup_src").val(popup.src);var srcset=ed.dom.getAttrib(n,"srcset");if(srcset){var sets=srcset.split(",");sets.length>1&&$(".uk-repeatable","#responsive_tab").trigger("repeatable:clone",sets.length-1),$.each(sets,function(i,set){var values=set.split(" ");$('input[name^="responsive_source"]').eq(i).val(values.shift()),$.each(values,function(x,v){v.indexOf("w")!==-1&&(v=v.replace(/[^0-9]+/g,""),$('input[name^="responsive_width_descriptor"]').eq(i).val(v)),v.indexOf("x")!==-1&&(v=v.replace(/[^0-9\.]+/g,""),$('input[name^="responsive_pixel_density"]').eq(i).val(v))})})}$("#responsive_sizes").val(ed.dom.getAttrib(n,"sizes"))}else Wf.setDefaults(this.settings.defaults);$("#src").filebrowser().on("filebrowser:onfileclick",function(e,file,data){self.selectFile(file,data)}).on("filebrowser:onfileinsert",function(e,file,data){self.selectFile(file,data)}).on("filebrowser:createthumbnail",function(){self._createThumbnail()}).on("filebrowser:deletethumbnail",function(){self._deleteThumbnail()}).on("filebrowser:selectmultiple",function(){self.selectMultiple()}),Wf.updateStyles(),$(".uk-repeatable").on("repeatable:create",function(e,o,n){$('input[name^="responsive_source"]',n).focus()}),$(".uk-constrain-checkbox").on("constrain:change",function(e,elms){$(elms).addClass("uk-isdirty")}).trigger("constrain:update"),$(".uk-equalize-checkbox").trigger("equalize:update")},refresh:function(){$("#src").trigger("filebrowser:refresh")},insert:function(){var ed=tinyMCEPopup.editor,t=this,n=ed.selection.getNode();return""===$("#src:enabled").val()?(Wf.Modal.alert(tinyMCEPopup.getLang("imgmanager_ext_dlg.no_src","Please enter a url for the image")),!1):(n&&"IMG"===n.nodeName&&""===ed.dom.getAttrib(n,"alt")&&this.insertAndClose(),void(""===$("#alt:enabled").val()?Wf.Modal.confirm(tinyMCEPopup.getLang("imgmanager_ext_dlg.missing_alt"),function(state){state&&t.insertAndClose()},{width:300,height:200}):this.insertAndClose()))},insertAndClose:function(){function _insert(el,args){if("string"==typeof el){ed.execCommand("mceInsertContent",!1,el,{skip_undo:1});var el=ed.dom.get("__mce_tmp");return n&&"A"===n.nodeName&&ed.dom.insertAfter(el,n),tinymce.each(ed.dom.select("img[data-popup-src]"),function(img){popups.push({el:img,src:img.getAttribute("data-popup-src")}),img.removeAttribute("data-popup-src")}),void ed.dom.remove(el,1)}if(el&&"IMG"===el.nodeName)ed.dom.setAttribs(el,args),br&&"BR"===br.nodeName?(($("#clear").is(":disabled")||""===$("#clear").val())&&ed.dom.remove(br),$("#clear").is(":disabled")||""===$("#clear").val()||ed.dom.setStyle(br,"clear",$("#clear").val())):$("#clear").is(":disabled")||""===$("#clear").val()||(br=ed.dom.create("br"),ed.dom.setStyle(br,"clear",$("#clear").val()),ed.dom.insertAfter(br,el));else{var n=el;ed.execCommand("mceInsertContent",!1,'<img id="__mce_tmp" src="" />',{skip_undo:1});var el=ed.dom.get("__mce_tmp");n&&"A"===n.nodeName&&ed.dom.insertAfter(el,n),$("#clear").is(":disabled")||""===$("#clear").val()||(br=ed.dom.create("br"),ed.dom.setStyle(br,"clear",$("#clear").val()),ed.dom.insertAfter(br,el)),ed.dom.setAttrib(el,"id",""),ed.dom.setAttribs(el,args)}var stamp="";/\.(jpg|jpeg|png)$/.test(args.src)&&(stamp="?"+(new Date).getTime()),args.src=ed.convertURL(args.src,"src","IMG"),ed.dom.setAttrib(el,"src",args.src+stamp),ed.dom.setAttrib(el,"data-mce-src",args.src),el.removeAttribute("data-popup-src"),popups.push({el:el,src:args["data-popup-src"]})}var v,el,ed=tinyMCEPopup.editor,self=this,args={},br="";Wf.updateStyles(),tinyMCEPopup.restoreSelection(),ed.settings.inline_styles!==!1&&(args={vspace:"",hspace:"",border:"",align:""}),$.each(["src","width","height","alt","title","classes","style","id","dir","lang","usemap","longdesc"],function(i,k){v=$("#"+k+":enabled").val(),"width"!=k&&"height"!=k||(v=self.settings.always_include_dimensions?$("#"+k).val():$("#"+k+".uk-isdirty").val()||""),"src"==k&&v&&(v=Wf.String.buildURI(v)),"classes"==k&&(k="class"),args[k]=tinymce.is(v)?v:""});var srcset=[];$('input[name^="responsive_source"]').each(function(i){var values=[],s=$(this).val(),w=$('input[name^="responsive_width_descriptor"]').eq(i).val(),x=$('input[name^="responsive_pixel_density"]').eq(i).val();s&&(s=Wf.String.buildURI(s),s=ed.convertURL(s,"srcset","IMG"),values.push(s),w&&values.push(w+"w"),x&&values.push(x+"x"),srcset.push(values.join(" ")))}),srcset.length&&(args.srcset=srcset.join(",")),args.sizes=$("#responsive_sizes").val(),args.onmouseover=args.onmouseout="";var files=$.fn.filebrowser.getselected();files.length||files.push($("#src").val());var popups=[],complete=!1,w=args.width,h=args.height,group=[];el=ed.selection.getNode(),br=el.nextSibling,$.each(files,function(i,file){if(files.length>1){var alt=$("input[name^=alt]").eq(i).val();$.extend(args,{src:$(file).data("url"),alt:alt});var fw=$(file).data("width"),fh=$(file).data("height");if(WFPopups.isEnabled()&&(args["data-popup-src"]=args.src,$(file).hasClass("thumbnail")&&$(file).data("thumbnail-src"))){var fw=$(file).data("thumbnail-width"),fh=$(file).data("thumbnail-height");args.src=$(file).data("thumbnail-src")}w&&h&&$.extend(args,Wf.sizeToFit({width:fw,height:fh},{width:w||fw,height:h||fh})),args.width!==fw&&w||delete args.width,args.height!==fh&&h||delete args.height;for(var k in args)""===args[k]&&delete args[k];group.push(ed.dom.createHTML("img",args))}else{var over=$("#onmouseover").val(),out=$("#onmouseout").val();over&&out&&(args.onmouseover="this.src='"+ed.convertURL(over)+"';",args.onmouseout="this.src='"+ed.convertURL(out)+"';"),WFPopups.isEnabled()&&(args["data-popup-src"]=$("#popup_src").val()),_insert(el,args)}i==files.length-1&&(complete=!0)}),group.length&&_insert('<span id="__mce_tmp">'+group.join("")+"</span>",args);$.each(popups,function(i,o){var args={popup_src:o.src,title:o.title};i&&tinymce.each(ed.dom.select("img[data-mce-popup]"),function(n){var link=ed.dom.getParent(n,"a");link&&(o.el=link.nextSibling)}),ed.dom.setAttrib(o.el,"data-mce-popup",1),ed.selection.select(o.el),WFPopups.createPopup(o.el,args,i)}),ed.dom.setAttrib(ed.dom.select("img[data-mce-popup]"),"data-mce-popup",null),ed.undoManager.add(),ed.nodeChanged(),complete&&tinyMCEPopup.close()},resetMultipleInputs:function(){$(".uk-input-multiple").each(function(){var el=this,id=$(el).attr("id");$('input[type="hidden"][name="'+id+'[]"]').remove(),$(el).parent().removeClass("uk-form-icon uk-form-icon-flip").find(".uk-icon-pencil").remove()})},toggleMultipleInputs:function(){var ed=tinyMCEPopup.editor;$(".uk-input-multiple").each(function(){function openModal(modal){var html="";$.each(selected,function(i){var inp=$('input[name="'+id+'[]"]').eq(i),value=$(inp).val();html+='<div class="uk-form-row"><label class="uk-form-label uk-width-1-10">'+(i+1)+'.</label><div class="uk-form-controls uk-width-9-10"><input type="text" value="'+value+'" /></div></div>'}),$(".uk-modal-body",modal).append(html).find('input[type="text"]').each(function(i){$(this).change(function(){$('input[name="'+id+'[]"]').eq(i).val(this.value),$(selected).eq(i).data(id,this.value)})})}var el=this,id=$(el).attr("id");$(el).attr("name",id+"[]"),$('input[type="hidden"][name="'+id+'[]"]').remove();var selected=$.fn.filebrowser.getselected();$(el).parent().toggleClass("uk-form-icon uk-form-icon-flip",selected.length>1),selected.length<2||($(selected).each(function(i){var n=this,value="";value=$(n).data(id)||"",value||"alt"!==id||(value=Wf.String.stripExt($(n).attr("title")).replace(/[_-]+/g," ")),0===i?$(el).val(value):$(el).parent().append('<input type="hidden" name="'+id+'[]" value="'+value+'" />'),$(n).data(id,value)}),$(el).siblings(".uk-icon-pencil").length||($(el).prop("disabled",!0),$('<i class="uk-icon uk-icon-pencil" role="button" />').click(function(){Wf.Modal.open($('label[for="'+el.id+'"]').text(),{width:300,buttons:[{text:ed.getLang("dlg.ok","Ok"),icon:"uk-icon-check",attributes:{class:"uk-button uk-modal-close"}}],open:function(){openModal(this)}})}).insertBefore(el)))})},setPopupSrc:function(file){var ed=tinyMCEPopup.editor,src=$(file).data("url");$(file).hasClass("thumbnail")&&Wf.Modal.confirm(ed.getLang("imgmanager_ext_dlg.use_thumbnail","Use associated thumbnail for popup link?"),function(state){if(state){var data={src:$(file).data("thumbnail-src"),width:$(file).data("thumbnail-width"),height:$(file).data("thumbnail-height")};$("#src").val(data.src);var name=Wf.String.stripExt($(file).attr("title")).replace(/[_-]+/g," ");$("#alt").val(name),data.width&&data.height?($("#width").val(data.width).data("tmp",data.width),$("#height").val(data.height).data("tmp",data.height)):($("#width").parent().append('<span class="loader"/>'),$("<img/>").attr("src",Wf.URL.toAbsolute(data.src)).load(function(){var w=this.width,h=this.height;$("#width").val(w).data("tmp",w),$("#height").val(h).data("tmp",h),$("#width~span.loader").remove()}))}}),$("#popup_src").val(src)},selectFile:function(file,data){tinyMCEPopup.editor;$("#item-list").hasClass("uk-sortable")&&$("#item-list").sortable("destroy"),$(".uk-input-multiple, .uk-input-multiple-disabled").prop("disabled",!1),this.resetMultipleInputs(),data||(data={url:$(file).data("url"),preview:$(file).data("preview"),title:$(file).attr("title"),width:$(file).data("width"),height:$(file).data("height")});var name=data.title,src=data.url,tab=$(".uk-active",".uk-tabs-panel").attr("id");if("rollover_tab"===tab)""===$("#onmouseout").val()?$("#onmouseout").val(src):$("#onmouseover").val(src);else if("popups_tab"===tab)this.setPopupSrc(file);else if("responsive_tab"===tab)$("input.uk-active","#responsive_tab").val(src);else if(name=Wf.String.stripExt(name).replace(/[_-]+/g," "),$("#alt").val(name),$("#onmouseout").val(src),$("#src").val(src),data.width&&data.height)$.each(["width","height"],function(i,k){$("#"+k).val(data[k]).data("tmp",data[k]).removeClass("uk-edited").addClass("uk-text-muted")});else{var img=new Image;img.onload=function(){$.each(["width","height"],function(i,k){$("#"+k).val(img[k]).data("tmp",img[k]).removeClass("uk-isdirty")})},img.src=src}$("#sample").attr({src:data.preview}).attr(Wf.sizeToFit({width:data.width,height:data.height},{width:80,height:60}))},selectMultiple:function(){var file,self=this,ed=tinyMCEPopup.editor;this.settings.defaults;$("#item-list").hasClass("uk-sortable")&&$("#item-list").sortable("destroy"),$(".uk-input-multiple, .uk-input-multiple-disabled").prop("disabled",!1);var selected=$.fn.filebrowser.getselected();!!WFPopups.isEnabled();if(selected.length)if(file=selected[0],$(file).data("width")&&$(file).data("height"))$.each(["width","height"],function(i,k){var v=$(file).data(k);$("#"+k).val(v).data("tmp",v)});else{var img=new Image;img.onload=function(){$.each(["width","height"],function(i,k){$("#"+k).val(img[k]).data("tmp",img[k])})},img.src=$("#src").val()}var tab=$(".uk-active",".uk-tabs-panel").attr("id");if(selected.length>1&&"image_tab"===tab&&(this.toggleMultipleInputs(),$(".uk-input-multiple, .uk-input-multiple-disabled").prop("disabled",!0)),selected.length&&"responsive_tab"===tab){var inp=$('input[name^="responsive_source"]'),diff=selected.length-inp.length;diff&&$(".uk-repeatable","#responsive_tab").trigger("repeatable:clone",diff),$(selected).each(function(i){var src=$(this).data("url");$('input[name^="responsive_source"]').eq(i).val(src)}),this.resetMultipleInputs()}var popup=WFPopups.isEnabled();popup&&"popups_tab"===tab&&($(".uk-input-multiple, .uk-input-multiple-disabled").prop("disabled",!0),$(file).hasClass("thumbnail")&&Wf.Modal.confirm(ed.getLang("imgmanager_ext_dlg.use_thumbnail","Use associated thumbnail for popup link?"),function(state){state&&$.each(["width","height"],function(i,k){$("#"+k).val($(file).data("thumbnail-"+k)).data("tmp",$(file).data("thumbnail-"+k))})}),this.toggleMultipleInputs());var grid=$("#browser").hasClass("view-mode-grid");$("#item-list").sortable({items:".file.selected",axis:!grid&&"y",placeholder:"uk-state-highlight",start:function(e,ui){$(ui.placeholder).css({width:$(ui.item).width(),height:$(ui.item).height()}),grid&&$(ui.placeholder).addClass("file thumbnail-preview thumbnail-loaded"),$(".file","#item-list").not(".selected, .uk-state-highlight").addClass("uk-state-disabled")},stop:function(e,ui){$(".uk-state-disabled","#item-list").removeClass("uk-state-disabled"),self.toggleMultipleInputs()}}).disableSelection()},_deleteThumbnail:function(){var item=$.fn.filebrowser.getselected()[0];Wf.Modal.confirm(tinyMCEPopup.getLang("imgmanager_ext_dlg.delete_thumbnail","Delete Thumbnail?"),function(state){if(state){var id=$(item).attr("id");$.fn.filebrowser.status({message:tinyMCEPopup.getLang("imgmanager_ext_dlg.delete_thumbnail_message","Deleting Thumbnail..."),state:"load"}),Wf.JSON.request("deleteThumbnail",[id],function(o){o.error.length&&Wf.Modal.alert(o.error),$.fn.filebrowser.load(id)})}})},_createThumbnail:function(){var self=this,s=self.settings,item=$.fn.filebrowser.getselected()[0];Wf.Modal.dialog(tinyMCEPopup.getLang("imgmanager_ext_dlg.create_thumbnail","Create Thumbnail"),"",{text:tinyMCEPopup.getLang("dlg.name","Name"),id:"thumbnail-create-dialog",width:680,height:420,dialogClass:"thumbnail",onOpen:function(){$("#thumbnail-create-dialog").thumbnail({src:$(item).data("preview")+"?"+(new Date).getTime(),values:{width:s.thumbnail_width,height:s.thumbnail_height,quality:s.thumbnail_quality}})},buttons:[{text:Wf.translate("save","Save"),icon:"uk-icon-check",attributes:{class:"uk-button-primary uk-modal-close"},click:function(){var data=$("#thumbnail-create-dialog").thumbnail("save"),args={json:[$(item).attr("id")]};$.merge(args.json,[data.width,data.height,data.quality,data.sx,data.sy,data.sw,data.sh]),$.fn.filebrowser.status({message:tinyMCEPopup.getLang("imgmanager_ext_dlg.create_thumbnail_message","Creating Thumbnail..."),state:"load"}),Wf.JSON.request("createThumbnail",args,function(o){o&&o.error&&o.error.length&&Wf.Modal.alert(o.error||"Unable to create thumbnail"),$.fn.filebrowser.load({name:$(item).attr("id")})},self)}}]})}};window.ImageManagerDialog=ImageManagerDialog,$(document).ready(function(){ImageManagerDialog.init()})}();